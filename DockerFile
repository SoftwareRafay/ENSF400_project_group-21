
# Base Image
FROM gradle:7.3.3-jdk11 AS builder

# Working directory
WORKDIR /desktop_app

#Install Application dependencies
COPY build.gradle ./
COPY gradlew gradlew.bat ./
COPY gradle ./gradle

# Install dependencies (cache this layer)
RUN ./gradlew dependencies --no-daemon

# Copy source code
COPY src ./src

# Build application
RUN ./gradlew assemble --no-daemon

# Runtime stage - JRE only
FROM eclipse-temurin:11-jre-jammy

WORKDIR /app

# Create non-root user
RUN groupadd -r appgroup && \
    useradd -r -g appgroup -d /app -s /bin/false appuser && \
    chown -R appuser:appgroup /app

# Copy built artifact from builder
COPY --from=builder --chown=appuser:appgroup /app/build/libs/*.jar app.jar

# Runtime config
USER appuser
EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]